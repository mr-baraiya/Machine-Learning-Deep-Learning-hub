<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SVR Kernel Regression Animation</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <style>
        body {
            background-color: #121212;
            color: #e0e0e0;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding: 20px;
        }
        h1 { margin-bottom: 5px; }
        p { max-width: 700px; text-align: center; color: #aaa; margin-bottom: 25px;}
        
        .controls {
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }
        button {
            padding: 12px 24px;
            font-size: 16px;
            cursor: pointer;
            background-color: #333;
            color: white;
            border: 2px solid #555;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        button:hover { background-color: #555; border-color: #777;}
        button.active { background-color: #00d2ff; border-color: #009ac2; color: #121212; font-weight: bold;}

        #plot-container {
            width: 90%;
            height: 70vh;
            min-height: 500px;
            background-color: #1e1e1e;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
            padding: 10px;
        }
    </style>
</head>
<body>

    <h1>SVR: Visualizing the Regression Kernel</h1>
    <p>How do we fit a straight line to curved data? We add a dimension! <br>Watch how the curve "unrolls" in 3D so a flat SVR plane can fit it perfectly.</p>

    <div class="controls">
        <button id="btn-2d" class="active" onclick="resetTo2D()">1. The Problem (2D Curve)</button>
        <button id="btn-3d" onclick="liftTo3D()">2. Kernel Transform (Add Z)</button>
        <button id="btn-plane" onclick="showPlane()">3. Fit Linear SVR Plane</button>
    </div>

    <div id="plot-container"></div>

    <script>
        // ===========================
        // 1. Data Generation (Parabola)
        // ===========================
        const N = 100;
        let x_data = [], y_data = [], z_flat = [], z_lifted = [];
        
        // Generate a curve: y = x^2 + noise
        for (let i = 0; i < N; i++) {
            // X from -5 to 5
            let x = (Math.random() * 10) - 5;
            let noise = (Math.random() - 0.5) * 4; // Add some noise
            let y = (x * x) + noise;

            x_data.push(x);
            y_data.push(y); // Y is the TARGET (Vertical in 2D)
            
            z_flat.push(-5); // Initially flat at the "back" of the plot
            z_lifted.push(x * x); // The Kernel Feature: Z = X^2
        }

        // Generate the SVR Plane (Prediction Sheet)
        // In 3D, if Z = X^2, then Y approx equals Z. 
        // So the plane is simply Y = Z.
        let plane_x = [], plane_y = [], plane_z = [];
        const gridSize = 10;
        
        for(let i=0; i<=gridSize; i++) {
            let row_x = [], row_y = [], row_z = [];
            // Z goes from 0 to 25 (since x is -5 to 5)
            let z_val = (i / gridSize) * 25; 
            
            for(let j=0; j<=gridSize; j++) {
                // X goes from -5 to 5
                let x_val = (j / gridSize) * 10 - 5;
                
                row_x.push(x_val);
                row_z.push(z_val); 
                // The Plane Equation: Predict Y based on Z
                row_y.push(z_val); 
            }
            plane_x.push(row_x); plane_y.push(row_y); plane_z.push(row_z);
        }

        // ===========================
        // 2. Initial Plot Setup
        // ===========================
        
        // Axes Configuration: 
        // X = Input Feature
        // Y = Target (Price/Value)
        // Z = Kernel Feature (Hidden at first)

        const scatterTrace = {
            x: x_data, 
            y: y_data, 
            z: z_flat,
            mode: 'markers',
            type: 'scatter3d',
            marker: { size: 5, color: '#ff385f', opacity: 0.9, line: {color: 'white', width: 0.5} },
            name: 'Data Points'
        };

        const planeTrace = {
            x: plane_x, y: plane_y, z: plane_z,
            type: 'surface',
            showscale: false,
            opacity: 0, // Hidden initially
            colorscale: 'Viridis',
            name: 'SVR Plane'
        };

        const layout = {
            paper_bgcolor: '#1e1e1e',
            margin: {l:0, r:0, t:0, b:0},
            scene: {
                // Initial Camera: Looking straight at X-Y (Front view)
                camera: { eye: {x: 0, y: 0, z: 2.0}, up: {x:0, y:1, z:0} }, 
                
                xaxis: {title: 'Input (X)', gridcolor: '#444', zeroline: false, color: '#ddd'},
                yaxis: {title: 'Target (Y)', gridcolor: '#444', zeroline: false, color: '#ddd'},
                zaxis: {title: 'Kernel Feature (X²)', gridcolor: '#444', range: [-5, 30], showticklabels: false, title: ''},
                aspectmode: 'manual', 
                aspectratio: {x:1, y:1, z:0.5}
            },
            showlegend: false
        };

        Plotly.newPlot('plot-container', [scatterTrace, planeTrace], layout, {responsive: true});


        // ===========================
        // 3. Animation Logic (Robust)
        // ===========================

        function updateButtons(activeId) {
            document.querySelectorAll('.controls button').forEach(b => b.classList.remove('active'));
            document.getElementById(activeId).classList.add('active');
        }

        function resetTo2D() {
            updateButtons('btn-2d');

            // 1. Move Camera to front view (2D)
            Plotly.animate('plot-container', {
                layout: { 
                    'scene.camera.eye': {x: 0, y: 0, z: 2.0},
                    'scene.zaxis.title': '' // Hide Z label
                }
            }, {transition: {duration: 1000}, frame: {duration: 1000}});

            // 2. Flatten data
            scatterTrace.z = z_flat;
            scatterTrace.marker.opacity = 0.9;
            planeTrace.opacity = 0; // Hide plane
            
            Plotly.react('plot-container', [scatterTrace, planeTrace], layout);
        }

        function liftTo3D() {
            updateButtons('btn-3d');

            // 1. Update Data: "Pop" the points out along Z axis based on X^2
            scatterTrace.z = z_lifted;
            scatterTrace.marker.opacity = 0.9;
            planeTrace.opacity = 0;

            // Update axes titles for 3D context
            layout.scene.zaxis.title = 'Kernel Feature (X²)';
            
            Plotly.react('plot-container', [scatterTrace, planeTrace], layout);

            // 2. Rotate Camera to show the depth
            Plotly.animate('plot-container', {
                layout: { 'scene.camera.eye': {x: 1.8, y: 0.5, z: 0.8} }
            }, {transition: {duration: 1500, easing: 'cubic-in-out'}, frame: {duration: 1500}});
        }

        function showPlane() {
            updateButtons('btn-plane');

            // 1. Show the Linear Plane cutting through data
            scatterTrace.z = z_lifted;
            scatterTrace.marker.opacity = 0.5; // Fade points
            planeTrace.opacity = 0.7; // Show plane

            Plotly.react('plot-container', [scatterTrace, planeTrace], layout);
            
            // Optional: Slight camera shift to admire the fit
            Plotly.animate('plot-container', {
                layout: { 'scene.camera.eye': {x: 2.0, y: 0.2, z: 0.5} }
            }, {transition: {duration: 1000}, frame: {duration: 1000}});
        }

    </script>
</body>
</html>